# DeskTransfer 打包说明

## 概述

DeskTransfer 是一个简单的局域网图片传输工具，支持批量图片传输功能。本说明文档将指导您如何将源代码打包成独立的可执行文件，无需安装Python环境即可在Windows上运行。

## 打包前准备

### 系统要求

- Windows 7 或更高版本
- Python 3.6 或更高版本（仅打包时需要）
- pip 包管理器（通常随Python安装）

### 安装依赖

在打包前，请确保已安装所有必要的依赖：

```bash
pip install -r requirements.txt
```

## 打包方法

### 方法一：使用批处理脚本（推荐）

1. 在Windows资源管理器中，导航到项目根目录
2. 双击运行 `build.bat` 文件
3. 等待脚本自动完成打包过程
4. 打包完成后，可执行文件将位于 `dist/DeskTransfer` 目录

### 方法二：使用Python脚本

1. 打开命令提示符或PowerShell
2. 导航到项目根目录
3. 运行以下命令：

```bash
python build_exe.py
```

### 方法三：手动使用PyInstaller

1. 安装PyInstaller（如果尚未安装）：

```bash
pip install pyinstaller
```

2. 运行以下命令进行打包：

```bash
pyinstaller DeskTransfer.spec
```

## 打包结果

打包完成后，`dist/DeskTransfer` 目录将包含以下文件：

- `DeskTransfer-Sender.exe` - 发送端应用程序
- `DeskTransfer-Receiver.exe` - 接收端应用程序
- `start.bat` - 启动脚本，提供菜单选择启动发送端或接收端
- `README.txt` - 简单使用说明
- `data/` - 数据目录，包含接收文件的子目录

## 使用打包后的应用程序

### 启动应用程序

有两种方式启动应用程序：

1. **使用启动脚本（推荐）**：
   - 双击运行 `start.bat`
   - 根据提示选择启动发送端(1)或接收端(2)

2. **直接运行可执行文件**：
   - 双击运行 `DeskTransfer-Sender.exe` 启动发送端
   - 双击运行 `DeskTransfer-Receiver.exe` 启动接收端

### 使用步骤

1. **启动接收端**：
   - 在接收端计算机上运行接收端程序
   - 点击"启动服务器"按钮
   - 记录显示的IP地址和端口号（默认为12345）

2. **启动发送端**：
   - 在发送端计算机上运行发送端程序
   - 在"接收端IP地址"中输入接收端的IP地址
   - 端口号保持默认（12345）

3. **选择并传输文件**：
   - 点击"选择文件"按钮，选择要传输的图片文件
   - 可以选择多个图片文件（支持批量传输）
   - 点击"连接"按钮连接到接收端
   - 连接成功后，点击"发送文件"开始传输

4. **查看接收的文件**：
   - 接收的文件将保存在 `data/received` 目录下
   - 可以在接收端界面中点击"打开接收文件夹"按钮直接打开

## 分发打包后的应用程序

您可以将整个 `dist/DeskTransfer` 目录复制到其他Windows计算机上使用，无需安装Python环境或任何依赖包。

### 注意事项

1. **网络连接**：确保发送端和接收端计算机在同一局域网内
2. **防火墙设置**：确保Windows防火墙允许程序通信（默认使用TCP端口12345）
3. **权限问题**：在某些系统上，可能需要管理员权限才能正常运行
4. **杀毒软件**：某些杀毒软件可能会误报，如遇此问题可将程序添加到白名单

## 常见问题

### Q: 打包失败怎么办？

A: 请检查以下几点：
1. 确保Python和pip已正确安装
2. 确保所有依赖包已安装
3. 尝试以管理员权限运行打包脚本
4. 查看错误信息，根据具体错误进行排查

### Q: 打包后的程序无法启动？

A: 可能的原因和解决方法：
1. 缺少必要的DLL文件：尝试在目标系统上安装Visual C++ Redistributable
2. 权限问题：以管理员权限运行程序
3. 杀毒软件拦截：将程序添加到杀毒软件白名单

### Q: 如何减小打包后文件的大小？

A: 可以尝试以下方法：
1. 使用UPX压缩（已在配置中启用）
2. 排除不需要的模块（已在配置中排除常见科学计算库）
3. 使用虚拟环境进行打包，避免包含不必要的包

### Q: 如何自定义应用程序图标？

A: 将图标文件（.ico格式）放在 `assets/icon.ico`，然后重新打包

## 技术细节

### 打包配置

打包配置文件 `DeskTransfer.spec` 包含以下设置：

- 包含的数据目录：`data/`, `ui/`, `common/`
- 隐藏导入：`tkinterdnd2`, `PIL`等PyInstaller可能无法自动检测的模块
- 排除的模块：`matplotlib`, `numpy`等不需要的科学计算库
- 无控制台窗口：使用GUI模式运行

### 依赖分析

应用程序依赖以下主要库：

- `tkinter` - GUI框架（Python标准库）
- `tkinterdnd2` - 拖放功能支持
- `PIL/Pillow` - 图像处理
- `psutil` - 系统信息获取
- `socket` - 网络通信（Python标准库）

## 更新日志

### v1.0.0
- 初始打包版本
- 支持将sender.py和receiver.py打包成独立可执行文件
- 包含所有必要的依赖和资源
- 提供Windows批处理脚本简化打包过程

## 联系方式

如有打包相关问题，请联系开发者。